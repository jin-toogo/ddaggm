generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-1.1.x", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Hospital {
  id               Int                      @id @default(autoincrement())
  encryptedCode    String                   @unique @map("encrypted_code") @db.VarChar(255)
  name             String                   @map("name") @db.VarChar(255)
  type             String                   @map("type") @db.VarChar(100)
  province         String                   @map("province") @db.VarChar(50)
  district         String                   @map("district") @db.VarChar(50)
  dong             String?                  @map("dong") @db.VarChar(50)
  postalCode       String?                  @map("postal_code") @db.VarChar(10)
  address          String                   @map("address") @db.Text
  latitude         Decimal?                 @map("latitude") @db.Decimal(10, 8)
  longitude        Decimal?                 @map("longitude") @db.Decimal(11, 8)
  phone            String?                  @map("phone") @db.VarChar(20)
  website          String?                  @map("website") @db.Text
  naverBlogUrl     String?                  @map("naver_blog_url") @db.VarChar(500)
  establishedDate  String?                  @map("established_date") @db.VarChar(20)
  totalDoctors     Int?                     @map("total_doctors")
  insurance        Boolean                  @default(false) @map("insurance")
  createdAt        DateTime                 @default(now()) @map("created_at")
  updatedAt        DateTime                 @updatedAt @map("updated_at")
  categoryCount    Int                      @default(0) @map("category_count")
  mainCategories   String?                  @map("main_categories") @db.LongText
  clinicCategories ClinicCategory[]
  locationDetails  HospitalLocationDetail?
  nonPaymentItems  HospitalNonPaymentItem[]
  operatingHours   HospitalOperatingHour?
  blogPosts        BlogPost[]

  @@index([name])
  @@index([province, district])
  @@index([type])
  @@index([insurance])
  @@index([latitude, longitude])
  @@map("hospitals")
}

model HospitalLocationDetail {
  id                 Int      @id @default(autoincrement())
  hospitalId         Int      @unique @map("hospital_id")
  landmark           String?  @map("landmark") @db.VarChar(255)
  direction          String?  @map("direction") @db.Text
  distance           String?  @map("distance") @db.VarChar(100)
  parkingSpaces      Int?     @map("parking_spaces")
  parkingFeeRequired String?  @map("parking_fee_required") @db.Char(1)
  parkingNotes       String?  @map("parking_notes") @db.Text
  createdAt          DateTime @default(now()) @map("created_at")
  updatedAt          DateTime @updatedAt @map("updated_at")
  hospital           Hospital @relation(fields: [hospitalId], references: [id], onDelete: Cascade)

  @@index([hospitalId])
  @@map("hospital_location_details")
}

model HospitalOperatingHour {
  id                Int       @id @default(autoincrement())
  hospitalId        Int       @unique @map("hospital_id")
  sundayInfo        String?   @map("sunday_info") @db.Text
  holidayInfo       String?   @map("holiday_info") @db.Text
  lunchWeekday      String?   @map("lunch_weekday") @db.Text
  lunchSaturday     String?   @map("lunch_saturday") @db.Text
  receptionWeekday  String?   @map("reception_weekday") @db.Text
  receptionSaturday String?   @map("reception_saturday") @db.Text
  sunStart          DateTime? @map("sun_start") @db.Time(0)
  sunEnd            DateTime? @map("sun_end") @db.Time(0)
  monStart          DateTime? @map("mon_start") @db.Time(0)
  monEnd            DateTime? @map("mon_end") @db.Time(0)
  tueStart          DateTime? @map("tue_start") @db.Time(0)
  tueEnd            DateTime? @map("tue_end") @db.Time(0)
  wedStart          DateTime? @map("wed_start") @db.Time(0)
  wedEnd            DateTime? @map("wed_end") @db.Time(0)
  thuStart          DateTime? @map("thu_start") @db.Time(0)
  thuEnd            DateTime? @map("thu_end") @db.Time(0)
  friStart          DateTime? @map("fri_start") @db.Time(0)
  friEnd            DateTime? @map("fri_end") @db.Time(0)
  satStart          DateTime? @map("sat_start") @db.Time(0)
  satEnd            DateTime? @map("sat_end") @db.Time(0)
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")
  hospital          Hospital  @relation(fields: [hospitalId], references: [id], onDelete: Cascade)

  @@index([hospitalId])
  @@map("hospital_operating_hours")
}

model HospitalNonPaymentItem {
  id            Int      @id @default(autoincrement())
  hospitalId    Int      @map("hospital_id")
  npayCode      String?  @map("npay_code") @db.VarChar(50)
  category      String?  @map("category") @db.VarChar(500)
  treatmentName String?  @map("treatment_name") @db.VarChar(255)
  amount        Int?     @map("amount")
  yadmNm        String?  @map("yadm_nm") @db.VarChar(255)
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")
  hospital      Hospital @relation(fields: [hospitalId], references: [id], onDelete: Cascade)

  @@unique([hospitalId, npayCode, treatmentName], name: "unique_hospital_item")
  @@index([hospitalId])
  @@index([category])
  @@index([amount])
  @@map("hospital_non_payment_items")
}

model Category {
  id               Int              @id @default(autoincrement())
  name             String           @map("name") @db.VarChar(50)
  slug             String           @unique @map("slug") @db.VarChar(50)
  description      String?          @map("description") @db.Text
  displayOrder     Int              @default(0) @map("display_order")
  isActive         Boolean          @default(true) @map("is_active")
  createdAt        DateTime         @default(now()) @map("created_at")
  updatedAt        DateTime         @updatedAt @map("updated_at")
  icon             String           @map("icon") @db.Text
  clinicCategories ClinicCategory[]

  @@index([slug])
  @@index([isActive])
  @@map("categories")
}

model ClinicCategory {
  id         Int      @id @default(autoincrement())
  clinicId   Int      @map("clinic_id")
  categoryId Int      @map("category_id")
  assignedBy Int?     @map("assigned_by")
  assignedAt DateTime @default(now()) @map("assigned_at")
  notes      String?  @map("notes") @db.Text
  isActive   Boolean  @default(true) @map("is_active")
  category   Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  hospital   Hospital @relation(fields: [clinicId], references: [id], onDelete: Cascade)

  @@unique([clinicId, categoryId], name: "unique_clinic_category")
  @@index([clinicId])
  @@index([categoryId])
  @@index([isActive])
  @@map("clinic_categories")
}

model BlogPost {
  id           String   @id @default(cuid())
  title        String   @map("title") @db.VarChar(500)
  content      String   @map("content") @db.Text
  summary      String?  @map("summary") @db.VarChar(500)
  imageUrl     String?  @map("image_url") @db.Text
  originalUrl  String   @unique @map("original_url") @db.VarChar(1000)
  publishedAt  DateTime @map("published_at")
  author       String   @map("author") @db.VarChar(100)

  // CSV 입력 정보
  clinicName    String? @map("clinic_name") @db.VarChar(255)
  clinicAddress String? @map("clinic_address") @db.Text
  hospitalId    Int?    @map("hospital_id")
  notes         String? @map("notes") @db.Text

  // 매칭 상태
  isMatched Boolean @default(false) @map("is_matched")

  // 메타데이터
  categories String   @map("categories") @db.Text
  tags       String   @map("tags") @db.Text
  isVerified Boolean @default(false) @map("is_verified")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  hospital Hospital? @relation(fields: [hospitalId], references: [id])

  @@index([publishedAt])
  @@index([clinicName])
  @@index([isMatched])
  @@index([hospitalId])
  @@map("blog_posts")
}